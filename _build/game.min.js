!function(){const e=320,n=180,r=e*n,i=6*r;S=Math.sin,C=Math.cos,viewX=0,viewY=0,viewW=e,viewH=n,cursorX=0,cursorY=0,cursorColor=22,cursorColor2=0,floodStack=[],fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0],pat=65535,palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];var o=document.getElementById("canvas"),a=o.getContext("2d"),s=0,u=[4278715910,4279439380,4280620859,4281145203,4280950964,4280499935,4278872826,4280001529,4282504703,4282449151,4284805846,4282637212,4281712985,4281245716,4282284570,4282077732,4280295442,4284757012,4291058728,4292779812,4291286560,4292607142,4294967295,4290835454,4290303738,4288127221,4285754088,4288367292,4286593657,4283642688,4281606692,4279901218,4280822578,4282073457,4282873275,4284720347,4288467700,4293583066,4291934643,4289696651,4287460717,4284634186,4282464563,4281541698,4281872731,4283585166,4285167034,4288919017,4294960867,4294688697,4293172100,4290678104,4286938439,4283328291,4284777522,4287475549,4290436242,4293064653,4289385188,4287344839,4284647072,4283787129,4282666586,4281612610];pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],a.imageSmoothingEnabled=!1,o.width=e,o.height=n;var l=a.getImageData(0,0,e,n),d=new ArrayBuffer(l.data.length),c=new Uint8Array(d),h=new Uint32Array(d),f=new Uint8Array(e*n*10);function y(t,r,i=64){return!(0-i>t||t>e+i||0-i>r||r>n+i)}function p(t,r){let i=(r|=0)%4*4+(t|=0)%4,o=pat&Math.pow(2,i),a=o?cursorColor:cursorColor2;0!=a&&(a>63&&(a=0),0>t|t>e-1||0>r|r>n-1||(f[s+r*e+t]=o?cursorColor:cursorColor2))}function w(e,t,n,r,i=cursorColor,o=cursorColor2){cursorX=n,cursorY=r,cursorColor2=o,cursorColor=i;var a,s,u=(r|=0)-(t|=0),l=(n|=0)-(e|=0);if(0>u?(u=-u,s=-1):s=1,0>l?(l=-l,a=-1):a=1,u<<=1,l<<=1,p(e,t),l>u)for(var d=u-(l>>1);e!=n;)0>d||(t+=s,d-=l),d+=u,p(e+=a,t);else for(d=l-(u>>1);t!=r;)0>d||(e+=a,d-=u),d+=l,p(e,t+=s)}function v(e,t,n=16,r=16,i=cursorColor,o=cursorColor2){cursorColor2=o,cursorColor=i,x1=0|e,y1=0|t,n|=0,r|=0,w(x1,y1,n,y1,i),w(n,y1,n,r,i),w(x1,r,n,r,i),w(x1,y1,x1,r,i)}function g(e,t,n=16,r=16,i=cursorColor,o=cursorColor2){cursorColor2=o,cursorColor=i,x1=0|e,y1=0|t,n|=0,i|=0;var a=(r|=0)-y1;if(w(x1,y1,n,y1,i),a>0)for(;--a;)w(x1,y1+a,n,y1+a,i);else if(0>a)for(;++a;)w(x1,y1+a,n,y1+a,i);w(x1,r,n,r,i)}function x(e){e[7]||(e[7]=1),e[8]||(e[8]=1);for(var n=e[0].length,r=0;n>r;r++){var i;i=m(e[0].charAt(r));for(var o=0;5>o;o++)for(var a=0;5>a;a++)if(1==i[5*o+a])if(1==e[4]){p(e[1]+a*e[4]+(5*e[4]+e[3])*r,e[2]+(e[6]?Math.sin(1*(t+r*e[8])/e[7])*e[6]:0)+o*e[4]|0)}else{let n=e[1]+a*e[4]+(5*e[4]+e[3])*r,i=e[2]+(e[6]?Math.sin(1*(t+r*e[8])/e[7])*e[6]:0)+o*e[4]|0;g(n,i,n+e[4],i+e[4],e[5])}}}function m(e){return index=fontString.indexOf(e),fontBitmap.substring(25*index,25*index+25).split("")}function M(e=Date.now(),t=1664525,n=1013904223,r=Math.pow(2,32)){this.seed=e,this.a=t,this.c=n,this.m=r}audioCtx=new AudioContext,Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)},Number.prototype.map=function(e,t,n,r){return(this-e)/(t-e)*(r-n)+n},Number.prototype.pad=function(e,t="0"){for(var n=String(this);n.length<(e||2);)n=t+n;return n},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}},M.prototype.setSeed=function(e){this.seed=e},M.prototype.nextInt=function(){return this.seed=(this.seed*this.a+this.c)%this.m,this.seed},M.prototype.nextFloat=function(){return this.nextInt()/this.m},M.prototype.nextBool=function(e){return null==e&&(e=.5),this.nextFloat()<e},M.prototype.nextFloatRange=function(e,t){return e+this.nextFloat()*(t-e)},M.prototype.nextIntRange=function(e,t){return Math.floor(this.nextFloatRange(e,t))},M.prototype.nextColor=function(){for(var e=this.nextIntRange(0,Math.pow(2,24)).toString(16).toUpperCase();6>e.length;)e="0"+e;return"#"+e};var D=function(){var e,t,n,r,i,o=function(e){return Math.sin(6.283184*e)},a=function(e){return.003959503758*Math.pow(2,(e-128)/12)},s=function(e,t,n){var r,i,o,s,l,d,c,h=u[e.i[0]],f=e.i[1],y=e.i[3],p=u[e.i[4]],w=e.i[5],v=e.i[8],g=e.i[9],x=e.i[10]*e.i[10]*4,C=e.i[11]*e.i[11]*4,m=e.i[12]*e.i[12]*4,M=1/m,D=e.i[13],K=n*Math.pow(2,2-e.i[14]),I=new Int32Array(x+C+m),W=0,X=0;for(r=0,i=0;x+C+m>r;r++,i++)0>i||(i-=K,d=a(t+(15&(D=D>>8|(255&D)<<4))+e.i[2]-128),c=a(t+(15&D)+e.i[6]-128)*(1+8e-4*e.i[7])),o=1,x>r?o=r/x:x+C>r||(o-=(r-x-C)*M),s=d,y&&(s*=o*o),l=h(W+=s)*f,s=c,v&&(s*=o*o),l+=p(X+=s)*w,g&&(l+=(2*Math.random()-1)*g),I[r]=80*l*o|0;return I},u=[o,function(e){return.5>e%1?1:-1},function(e){return e%1*2-1},function(e){var t=e%1*4;return 2>t?t-1:3-t}];this.init=function(o){e=o,t=o.endPattern,n=0,r=o.rowLen*o.patternLen*(t+1)*2,i=new Int32Array(r)},this.generate=function(){var a,l,d,c,h,f,y,p,w,v,g,x,C,m,M=new Int32Array(r),D=e.songData[n],K=e.rowLen,I=e.patternLen,W=0,X=0,Y=!1,A=[];for(d=0;t>=d;++d)for(y=D.p[d],c=0;I>c;++c){var H=y?D.c[y-1].f[c]:0;H&&(D.i[H-1]=D.c[y-1].f[c+I]||0,16>H&&(A=[]));var E=u[D.i[15]],L=D.i[16]/512,R=Math.pow(2,D.i[17]-9)/K,S=D.i[18],b=D.i[19],z=43.23529*D.i[20]*3.141592/44100,F=1-D.i[21]/255,G=1e-5*D.i[22],P=D.i[23]/32,U=D.i[24]/512,_=6.283184*Math.pow(2,D.i[25]-9)/K,B=D.i[26]/255,k=D.i[27]*K&-2;for(g=(d*I+c)*K,h=0;4>h;++h)if(f=y?D.c[y-1].n[c+h*I]:0){A[f]||(A[f]=s(D,f,K));var N=A[f];for(l=0,a=2*g;l<N.length;l++,a+=2)M[a]+=N[l]}for(l=0;K>l;l++)(v=M[p=2*(g+l)])||Y?(x=z,S&&(x*=E(R*p)*L+.5),X+=(x=1.5*Math.sin(x))*(C=F*(v-X)-(W+=x*X)),v=3==b?X:1==b?C:W,G&&(v=1>(v*=G)?v>-1?o(.25*v):-1:1,v/=G),Y=(v*=P)*v>1e-5,m=v*(1-(w=Math.sin(_*p)*U+.5)),v*=w):m=0,k>p||(m+=M[p-k+1]*B,v+=M[p-k]*B),M[p]=0|m,M[p+1]=0|v,i[p]+=0|m,i[p+1]+=0|v}return++n/e.numChannels},this.createWave=function(){var e=44+2*r-8,t=e-36,n=new Uint8Array(44+2*r);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var o=0,a=44;r>o;++o){var s=i[o];s=-32767>s?-32767:s>32767?32767:s,n[a++]=255&s,n[a++]=s>>8&255}return n},this.getBuffer=function(){return i},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),r=new Array(t),o=0;2*t>o;o+=1){var a=n+o;r[o]=e>0&&a<i.length?i[a]/32768:0}return r}},K={songData:[{i:[3,138,116,0,0,138,128,4,0,0,47,48,166,124,3,0,139,4,1,3,64,160,3,32,147,4,121,5],p:[1,1,4,2,3],c:[{n:[111],f:[]},{n:[114],f:[]},{n:[113],f:[]},{n:[112,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,113],f:[]}]}],rowLen:5513,patternLen:32,endPattern:4,numChannels:1};states={},init=(()=>{lcg=new M(1019),drawMap(),state="game",last=0,t=0,tileWidth=16,tileHeight=16,mapWidth=14,mapHeight=11,audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),audioMaster.connect(audioCtx.destination),player={x:500,y:500,speedX:5,speedY:5,width:4,height:4,color:25,tx:0,ty:0,gid:0,draw:function(){g(this.x-viewX,this.y-viewY,this.x-viewX+this.width,this.y-viewY+this.height,this.color,this.color-1)},updatePosition:function(){this.tx=this.x/tileWidth|0,this.ty=this.y/tileHeight|0,this.gid=i+this.tx+this.ty*e}},deadzoneX=50,deadzoneY=50,viewX=player.x-e/2,viewY=player.y-n/2,sounds={},music=new D,music.init(K),done=!1,setInterval(function(){done||(done=1==music.generate(),done&&(wave=music.createWave().buffer,audioCtx.decodeAudioData(wave,function(e){sounds.song=e,function(e,t=1,n=0,r=.5,i=!1){var o=audioCtx.createBufferSource(),a=audioCtx.createGain(),s=audioCtx.createStereoPanner();o.buffer=e,o.connect(s),s.connect(a),a.connect(audioMaster),o.playbackRate.value=t,o.loop=i,a.gain.value=r,s.pan.value=n,o.start()}(sounds.song,1,0,.5,!0)})))},0),paused=!1,loop()}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(n=>{paused?(!function(e){var t=5*e[7],n=e[0].split("\n"),r=n.slice(0),i=n.length,o=r.sort(function(e,t){return t.length-e.length})[0],a=o.length*t+(o.length-1)*e[3],s=i*t+(i-1)*e[4];e[5]||(e[5]="left"),e[6]||(e[6]="bottom");var u=e[1],l=e[2],d=e[1]+a,c=e[2]+s;"center"==e[5]?(u=e[1]-a/2,d=e[1]+a/2):"right"==e[5]&&(u=e[1]-a,d=e[1]),"center"==e[6]?(l=e[2]-s/2,c=e[2]+s/2):"bottom"==e[6]&&(l=e[2]-s,c=e[2]);for(var h=u+a/2,f=l+s/2,y=0;i>y;y++){var p=n[y],w=p.length*t+(p.length-1)*e[3],v=e[1],g=e[2]+(t+e[4])*y;"center"==e[5]?v=e[1]-w/2:"right"==e[5]&&(v=e[1]-w),"center"==e[6]?g-=s/2:"bottom"==e[6]&&(g-=s),x([p,v,g,e[3]||0,e[7]||1,e[8],e[9],e[10],e[11]])}}(["PAUSED",e/2,128,3,1,"center","top",3,21,0]),audioMaster.gain.value=0):(dt=1,t+=1,audioMaster.gain.value=1,states[state].step(1),states[state].draw()),function(){for(var e=r;e--;)h[e]=u[pal[f[e]]];l.data.set(c),a.putImageData(l,0,0)}(),requestAnimationFrame(loop)}),drawMap=(t=>{s=i,function(e=cursorColor,t=cursorColor2){cursorColor=e,cursorColor2=t}(1,1),v(0,0,e,n,1);for(let t=0;600>t;t++)p(lcg.nextIntRange(1,e),lcg.nextIntRange(1,n));s=0}),getGID=((t,n)=>{let r=t/tileWidth|0,o=n/tileHeight|0;return i+r+o*e}),states.game={step:function(e){player.updatePosition(),Key.isDown(Key.d)||Key.isDown(Key.RIGHT)?1!=f[getGID(player.x+5,player.y)]&&(player.x+=2):(Key.isDown(Key.a)||Key.isDown(Key.LEFT))&&1!=f[getGID(player.x-2,player.y)]&&(player.x-=2),Key.isDown(Key.w)||Key.isDown(Key.UP)?1!=f[getGID(player.x,player.y-2)]&&(player.y-=2):(Key.isDown(Key.s)||Key.isDown(Key.DOWN))&&1!=f[getGID(player.x,player.y+5)]&&(player.y+=2),player.x-viewX+deadzoneX>viewW?viewX=player.x-(viewW-deadzoneX):player.x-deadzoneX<viewX&&(viewX=player.x-deadzoneX),player.y-viewY+deadzoneY>viewH?viewY=player.y-(viewH-deadzoneY):player.y-deadzoneY<viewY&&(viewY=player.y-deadzoneY)},draw:function(t){s=0,pat=dither[8],function(e=0,t=s){f.fill(e,t,t+r)}(0);for(let t=0;e>t;t++)for(let r=0;n>r;r++){if(1==f[i+r*e+t]){let e=t*tileWidth-viewX,n=r*tileHeight-viewY;y(e,n,tileWidth)&&(g(e+1,n+1,e+tileWidth-1,n+tileHeight-1,8,7),v(e,n,e+tileWidth+1,n+tileHeight+1,6,7))}else{let e=t*tileWidth-viewX,n=r*tileHeight-viewY;y(e,n,tileWidth)&&(g(e,n,e+tileWidth,n+tileHeight,2,1),v(e,n,e+tileWidth,n+tileHeight,2,3))}}player.draw()}},window.init()}();